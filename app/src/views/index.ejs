<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plantas Medicinales</title>
    <link rel="stylesheet" href="/recursos/estilos/styles.css?v=<%= Date.now() %>">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <%- include('partials/header', { usuario, isAuthenticated }) %>

    <main class="contenido-principal">
        <section class="barra-lateral">
            <div class="cientifico-destacado">
                <h3>Cat谩logo Cient铆fico</h3>
                <p>Explora nuestra colecci贸n de plantas medicinales con informaci贸n cient铆fica detallada.</p>
            </div>
            
            <form class="busqueda" onsubmit="return false;">
                <input type="text" placeholder="Buscar planta medicinal..." id="busqueda-input">
            </form>
            
            <div class="lista-elementos" id="lista-plantas">
                <% plantas.forEach(function(planta) { %>
                <div class="elemento planta-item" data-nombre="<%= planta.nombre %>">
                    <div class="imagen-placeholder">
                        <% if(planta.imagen) { %>
                            <img src="/recursos/imagenes/<%= planta.imagen %>" alt="<%= planta.nombre %>" style="width:50px;height:50px;object-fit:cover;border-radius:8px;">
                        <% } else { %>
                            
                        <% } %>
                    </div>
                    <span class="nombre"><%= planta.nombre %></span>
                </div>
                <% }); %>
            </div>
        </section>
        
        <section class="descripcion" id="info-planta">
            <div class="descripcion-texto" id="info-planta-content">
                <div class="alert-info">
                    <h3><i class="fas fa-microscope"></i> Informaci贸n Cient铆fica</h3>
                    <p>Selecciona una planta del cat谩logo para consultar su informaci贸n cient铆fica detallada, incluyendo:</p>
                    <ul style="margin: 12px 0; padding-left: 20px;">
                        <li>Nomenclatura cient铆fica</li>
                        <li>Propiedades medicinales</li>
                        <li>Distribuci贸n geogr谩fica</li>
                        <li>Usos tradicionales y modernos</li>
                    </ul>
                </div>
            </div>
        </section>
    </main>
    
    <%- include('partials/footer') %>
    
    <!-- Modal para solicitud de donaci贸n -->
    <% if (isAuthenticated && usuario && usuario.tipo == 0) { %>
    <div id="modal-solicitud-donacion" class="modal" style="display:none;">
        <div class="modal-content">
            <h2><i class="fas fa-seedling"></i> Solicitud de Donaci贸n Cient铆fica</h2>
            <div class="alert-info">
                <p><strong>Contribuci贸n Cient铆fica:</strong> Tu donaci贸n ayudar谩 a enriquecer nuestro cat谩logo cient铆fico y promover la investigaci贸n en plantas medicinales.</p>
            </div>
            <form action="/solicitudes/enviar" method="post">
                <label>
                    <i class="fas fa-leaf"></i> Nombre com煤n de la planta:
                    <input type="text" name="nombre_planta" required placeholder="Ej: Manzanilla, Romero, Albahaca...">
                </label>
                <label>
                    <i class="fas fa-file-alt"></i> Descripci贸n morfol贸gica:
                    <textarea name="descripcion_planta" required placeholder="Describe las caracter铆sticas f铆sicas de la planta (tama帽o, forma de hojas, flores, etc.)..."></textarea>
                </label>
                <label>
                    <i class="fas fa-pills"></i> Propiedades medicinales conocidas:
                    <textarea name="propiedades_medicinales" required placeholder="Describe las propiedades medicinales y usos terap茅uticos documentados..."></textarea>
                </label>
                <label>
                    <i class="fas fa-map-marker-alt"></i> Ubicaci贸n geogr谩fica:
                    <input type="text" name="ubicacion" required placeholder="Ej: Jard铆n particular, Parque local, rea natural protegida...">
                </label>
                <label>
                    <i class="fas fa-heart"></i> Motivo de la donaci贸n:
                    <textarea name="motivo_donacion" required placeholder="Explica el prop贸sito cient铆fico o educativo de tu donaci贸n..."></textarea>
                </label>
                <div style="display: flex; gap: 12px; margin-top: 24px; justify-content: center;">
                    <button type="submit"><i class="fas fa-paper-plane"></i> Enviar Solicitud</button>
                    <button type="button" onclick="document.getElementById('modal-solicitud-donacion').style.display='none'"><i class="fas fa-times"></i> Cancelar</button>
                </div>
            </form>
        </div>
    </div>
    <% } %>
    
    <script>
    var btnMenu = document.getElementById('btn-menu');
    if(btnMenu){
        btnMenu.onclick = function() {
            var menu = document.getElementById('menu-opciones');
            if(menu.style.display === 'flex'){
                menu.style.display = 'none';
            } else {
                menu.style.display = 'flex';
                menu.style.flexDirection = 'column';
            }
        };
    }
    
    // Funci贸n para filtrar plantas
    function filtrarPlantas() {
        var busqueda = document.getElementById('busqueda-input').value.toLowerCase();
        var plantas = document.querySelectorAll('.planta-item');
        
        plantas.forEach(function(planta) {
            var nombre = planta.querySelector('.nombre').textContent.toLowerCase();
            if (nombre.includes(busqueda)) {
                planta.style.display = 'flex';
            } else {
                planta.style.display = 'none';
            }
        });
    }
    
    // B煤squeda en tiempo real
    document.getElementById('busqueda-input').addEventListener('input', filtrarPlantas);
    
    // Modal de solicitud de donaci贸n
    var btnSolicitud = document.getElementById('btn-solicitud-donacion');
    if(btnSolicitud){
        btnSolicitud.onclick = function(e) {
            e.preventDefault();
            document.getElementById('modal-solicitud-donacion').style.display = 'flex';
        };
    }
    
    // Cerrar modal al hacer clic fuera
    var modalSolicitud = document.getElementById('modal-solicitud-donacion');
    if(modalSolicitud){
        modalSolicitud.onclick = function(e){
            if(e.target === this) this.style.display = 'none';
        };
    }
    
    document.querySelectorAll('.planta-item').forEach(function(item){
        item.onclick = function() {
            // Remover selecci贸n previa
            document.querySelectorAll('.planta-item').forEach(function(el) {
                el.classList.remove('selected');
            });
            
            // Agregar selecci贸n al elemento actual
            this.classList.add('selected');
            
            var nombre = this.dataset.nombre;
            var xhr = new XMLHttpRequest();
            xhr.open('POST', '/plantas/info', true);
            xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
            xhr.onload = function() {
                document.getElementById('info-planta-content').innerHTML = xhr.responseText;
            };
            xhr.send('nombre=' + encodeURIComponent(nombre));
        };
    });
    </script>
</body>
</html>

